# T-014: Error Model — handler padronizado, Request ID, OpenAPI e refactor de complexidade

## Contexto
Padroniza respostas de erro em toda a API com `request_id` para rastreabilidade e reduz a complexidade cognitiva do exception handler, alinhado ao blueprint e às boas práticas do projeto.

## O que foi feito
- Handler global padronizado com payload de erro (campos de topo): `detail`, `code`, `errors?`, `request_id`.
- Middleware de Request ID: aceita `X-Request-ID` (UUID) quando enviado; gera quando ausente/inválido; propaga em header e payload de erro.
- Códigos de erro padronizados: `validation_error`, `authentication_failed`, `permission_denied`, `not_found`, `method_not_allowed`, `throttled`, `internal_server_error`.
- Logging: lazy logging com `request_id`, `path`, `method`, `status_code`, `code`, `view` (sem PII), conforme blueprint.
- OpenAPI: componente de erro e respostas padronizadas aplicadas em Versions, AI, Books, Verses, Themes e CrossRefs.
- Refactor (Sonar): extração de helpers e logging lazy no `custom_exception_handler` para reduzir complexidade.

## Arquivos principais
- `common/exceptions.py`
- `common/middleware.py`
- `common/openapi.py`
- `bible/versions/views.py`
- `bible/ai/views.py`
- `bible/books/views.py`
- `bible/verses/views.py`
- `bible/themes/views.py`
- `bible/crossrefs/views.py`
- `config/settings.py` (EXCEPTION_HANDLER)
- `docs/tasks/*` (T-014 done, T-015 done, INDEX atualizado)

## Compatibilidade
- 401 inclui `WWW-Authenticate: Api-Key realm="bible-api"`.
- 429 padronizado como `throttled` (inclui `Retry-After` quando disponível).
- Formato de erro unificado (campos de topo). Clientes devem ler `detail`, `code`, `errors?`, `request_id`.

## Testes
- Unit e integração cobrindo: 400/401/403/404/405/429/500; headers 401/429; propagação de `X-Request-ID` válido e geração quando ausente/ inválido.

## Tarefas
- Closes T-014: `docs/tasks/2025-09-07--api--error-model-standardization.md`
- Closes T-015: `docs/tasks/2025-09-07--api--error-model-polish.md`

## Checklist
- [ ] CI verde: `make ci-test`
- [ ] Schema gerado/ok: `make ci-schema`
- [ ] Sem PII em logs
- [ ] Documentação do schema de erros consistente

## Labels e Milestone
- Labels: `area/api`, `type/feature`, `type/docs`, `type/test`, `needs-schema`
- Milestone: `Fundação da API`
